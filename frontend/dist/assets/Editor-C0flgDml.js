import{j as Y,Z as B,t as A,Q as oe,J as D,X as se,b as ee,M as q,N as te,O as ne,A as re,_ as M,s as O,k as ie,o as P,r as x,u as le,a as R,c as ce,d as de,e as ue,f as e,g as pe,U as z,E as he,h as me,P as Q,i as K,l as fe,m as be,I as ge,n as xe,p as je,$ as H,q as Ce,v as i,w as J,x as ke,W as ye,y as Ne,z as ve,B as L,C as Se,D as _e,F as Ee,G as Ie,H as Ue,K as Me,T as $e,L as Be,R as Ae,S as Oe,V as Pe,Y as Te,a0 as we,a1 as De}from"./index-ug5mBQNB.js";const F=0,W=1,G=2,E=0,Je=1,V=2,Fe=3,He=4;function Le(t,a,r,u,g){if(t===null||r.size===0&&u.size===0&&!g)return E;const n=a._selection,s=t._selection;if(g)return Je;if(!(M(n)&&M(s)&&s.isCollapsed()&&n.isCollapsed()))return E;const l=(function(N,f,S){const I=N._nodeMap,C=[];for(const v of f){const U=I.get(v);U!==void 0&&C.push(U)}for(const[v,U]of S){if(!U)continue;const _=I.get(v);_===void 0||ie(_)||C.push(_)}return C})(a,r,u);if(l.length===0)return E;if(l.length>1){const N=a._nodeMap,f=N.get(n.anchor.key),S=N.get(s.anchor.key);return f&&S&&!t._nodeMap.has(f.__key)&&O(f)&&f.__text.length===1&&n.anchor.offset===1?V:E}const p=l[0],h=t._nodeMap.get(p.__key);if(!O(h)||!O(p)||h.__mode!==p.__mode)return E;const o=h.__text,c=p.__text;if(o===c)return E;const b=n.anchor,k=s.anchor;if(b.key!==k.key||b.type!=="text")return E;const j=b.offset,m=k.offset,y=c.length-o.length;return y===1&&m===j-1?V:y===-1&&m===j+1?Fe:y===-1&&m===j?He:E}function qe(t,a){let r=Date.now(),u=E;return(g,n,s,l,p,h)=>{const o=Date.now();if(h.has(q))return u=E,r=o,G;const c=Le(g,n,l,p,t.isComposing()),b=(()=>{const k=s===null||s.editor===t,j=h.has(ne);if(!j&&k&&h.has(re))return F;if(g===null)return W;const m=n._selection;return l.size>0||p.size>0?j===!1&&c!==E&&c===u&&o<r+a&&k||l.size===1&&(function(y,N,f){const S=N._nodeMap.get(y),I=f._nodeMap.get(y),C=N._selection,v=f._selection;return!(M(C)&&M(v)&&C.anchor.type==="element"&&C.focus.type==="element"&&v.anchor.type==="text"&&v.focus.type==="text"||!O(S)||!O(I)||S.__parent!==I.__parent)&&JSON.stringify(N.read((()=>S.exportJSON())))===JSON.stringify(f.read((()=>I.exportJSON())))})(Array.from(l)[0],g,n)?F:W:m!==null?F:G})();return r=o,u=c,b}}function X(t){t.undoStack=[],t.redoStack=[],t.current=null}function Re(t,a,r){const u=qe(t,r);return Y(t.registerCommand(te,(()=>((function(n,s){const l=s.redoStack,p=s.undoStack;if(p.length!==0){const h=s.current,o=p.pop();h!==null&&(l.push(h),n.dispatchCommand(B,!0)),p.length===0&&n.dispatchCommand(A,!1),s.current=o||null,o&&o.editor.setEditorState(o.editorState,{tag:q})}})(t,a),!0)),D),t.registerCommand(ee,(()=>((function(n,s){const l=s.redoStack,p=s.undoStack;if(l.length!==0){const h=s.current;h!==null&&(p.push(h),n.dispatchCommand(A,!0));const o=l.pop();l.length===0&&n.dispatchCommand(B,!1),s.current=o||null,o&&o.editor.setEditorState(o.editorState,{tag:q})}})(t,a),!0)),D),t.registerCommand(se,(()=>(X(a),!1)),D),t.registerCommand(oe,(()=>(X(a),t.dispatchCommand(B,!1),t.dispatchCommand(A,!1),!0)),D),t.registerUpdateListener((({editorState:n,prevEditorState:s,dirtyLeaves:l,dirtyElements:p,tags:h})=>{const o=a.current,c=a.redoStack,b=a.undoStack,k=o===null?null:o.editorState;if(o!==null&&n===k)return;const j=u(s,n,o,l,p,h);if(j===W)c.length!==0&&(a.redoStack=[],t.dispatchCommand(B,!1)),o!==null&&(b.push({...o}),t.dispatchCommand(A,!0));else if(j===G)return;a.current={editor:t,editorState:n}})))}function ze(){return{current:null,redoStack:[],undoStack:[]}}function Qe({delay:t,externalHistoryState:a}){const[r]=P();return(function(u,g,n=1e3){const s=x.useMemo((()=>g||ze()),[g]);x.useEffect((()=>Re(u,s,n)),[n,u,s])})(r,a,t),null}function We({defaultSelection:t}){const[a]=P();return x.useEffect((()=>{a.focus((()=>{const r=document.activeElement,u=a.getRootElement();u===null||r!==null&&u.contains(r)||u.focus({preventScroll:!0})}),{defaultSelection:t})}),[t,a]),null}function Z(){const t=le(),a=R(c=>c.ui.postId),[r]=P(),[u,{error:g}]=ce(),[n,{error:s}]=de(),[l,{error:p}]=ue(),h=R(c=>c.ui.imageUploading),o=async c=>{var j;r.focus();const b=(j=c.target.files)==null?void 0:j[0];if(!b)return;if(!b.type.startsWith("image/")){alert("Please upload an image file");return}let k;r.update(()=>{var m;k=(m=Q())==null?void 0:m.clone()}),t(K(!0));try{let m=a;if(!m){const f=await u({title:"",content:"",status:"draft"}).unwrap();t(fe(f.id)),m=f.id}const y=new FormData;y.append("image",b),y.append("postId",m.toString());const N=await l(y).unwrap();r.focus(()=>{r.update(()=>{M(k)&&be(k),r.dispatchCommand(ge,{src:N,alt:b.name})},{onUpdate:()=>{const f=r.getEditorState(),S=JSON.stringify(f.toJSON());n({postId:m,content:S}).unwrap().finally(()=>{t(K(!1))})}})})}catch(m){console.error(m)}};return e.jsxs("div",{className:"image-inputBox",children:[e.jsx("input",{id:"imageUpload",className:"image-input",type:"file",accept:"image/*",onChange:o}),e.jsx("label",{className:`${z.appButton} ${z.primary} toolbar-button `,htmlFor:"imageUpload",children:"Add Image"}),(g||p||s)&&e.jsx(he,{message:"failed to add image"}),h&&pe.createPortal(e.jsx(me,{mode:"page"}),document.body)]})}function Ge(){const[t]=P(),[a,r]=x.useState("paragraph"),[u,g]=x.useState(!1),[n,s]=x.useState(!1),[l,p]=x.useState(!1),[h,o]=x.useState(!1),[c,b]=x.useState(!1),[k,j]=x.useState(!1),[m,y]=x.useState(!1),N=xe(),[f,S]=x.useState(!1),I=x.useCallback(()=>{const d=Q();if(M(d)){const $=d.getNodes();let T;for(const ae of $){const w=ae.getTopLevelElementOrThrow();je(w)?T=w.getTag():ke(w)?T="quote":ye(w)&&(T="paragraph"),r(T??"paragraph");break}p(d.hasFormat("bold")),o(d.hasFormat("italic")),b(d.hasFormat("underline")),j(d.hasFormat("strikethrough"))}else p(!1),o(!1),b(!1),j(!1)},[]);x.useEffect(()=>Y(t.registerUpdateListener(({editorState:d})=>{d.read(()=>{I()})}),t.registerCommand(Ce,()=>(I(),!1),H),t.registerCommand(A,d=>(g(d),!1),H),t.registerCommand(B,d=>(s(d),!1),H)),[I,t]);const C=d=>{t.focus(),t.dispatchCommand(Ne,d)},v=d=>{t.focus(),t.dispatchCommand(ve,d)},U=d=>{t.focus(),d==="undo"?t.dispatchCommand(te,void 0):d==="redo"&&t.dispatchCommand(ee,void 0)},_=d=>{t.focus(),t.update(()=>{const $=Q();M($)&&(d==="paragraph"?L($,()=>Se()):d==="quote"?L($,()=>_e()):L($,()=>Ee(d)))})};return e.jsx("div",{className:"toolBar-container",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"toolBar",children:[e.jsxs("div",{className:"button-group-wrapper",children:[e.jsxs("div",{className:"button-group",role:"group","aria-label":"Text formatting",children:[e.jsx(i,{type:"button","aria-label":"Bold",className:`toolbar-button ${l?"active":""}`,onClick:()=>C("bold"),children:"Bold"}),e.jsx(i,{type:"button","aria-label":"Italic",className:`toolbar-button ${h?"active":""}`,onClick:()=>C("italic"),children:"Italic"}),e.jsx(i,{type:"button","aria-label":"Underline",className:`toolbar-button ${c?"active":""}`,onClick:()=>C("underline"),children:"Underline"}),e.jsx(i,{type:"button","aria-label":"Strikethrough",className:`toolbar-button ${k?"active":""}`,onClick:()=>C("strikethrough"),children:"Strikethrough"})]}),e.jsxs("div",{className:"button-group",role:"group","aria-label":"Text formatting",children:[e.jsx(i,{type:"button","aria-label":"Align left",className:"toolbar-button",onClick:()=>v("left"),children:"Left"}),e.jsx(i,{type:"button","aria-label":"Align center",className:"toolbar-button",onClick:()=>v("center"),children:"Center"}),e.jsx(i,{type:"button","aria-label":"Align right",className:"toolbar-button",onClick:()=>v("right"),children:"Right"}),e.jsx(i,{type:"button","aria-label":"Justify text",className:"toolbar-button",onClick:()=>v("justify"),children:"Justify"})]})]}),e.jsx("div",{className:`${z.divider} toolBar-divider`,children:e.jsx("span",{})}),e.jsxs("div",{className:"button-group-wrapper",children:[e.jsxs("div",{className:"button-group",role:"group","aria-label":"Block types",children:[e.jsx(i,{type:"button","aria-label":"Heading 1",className:`toolbar-button ${a==="h1"?"active":""}`,onClick:()=>_("h1"),children:"H1"}),e.jsx(i,{type:"button","aria-label":"Heading 2",className:`toolbar-button ${a==="h2"?"active":""}`,onClick:()=>_("h2"),children:"H2"}),e.jsx(i,{type:"button","aria-label":"Heading 3",className:`toolbar-button ${a==="h3"?"active":""}`,onClick:()=>_("h3"),children:"H3"}),e.jsx(i,{type:"button","aria-label":"Paragraph",className:`toolbar-button ${a==="paragraph"?"active":""}`,onClick:()=>_("paragraph"),children:"Paragraph"})]}),e.jsxs("div",{className:"button-group",role:"group","aria-label":"Text formatting",children:[e.jsx(i,{type:"button","aria-label":"Quote",className:`toolbar-button ${a==="quote"?"active":""}`,onClick:()=>_("quote"),children:"Quote"}),e.jsx(Z,{}),e.jsx(i,{type:"button","aria-label":"Undo",className:"toolbar-button",disabled:!u,onClick:()=>U("undo"),children:"Undo"}),e.jsx(i,{type:"button","aria-label":"Redo",className:"toolbar-button",disabled:!n,onClick:()=>U("redo"),children:"Redo"})]})]})]}),e.jsx(i,{onClick:()=>y(!m),className:" nav-collapse-button",children:m?"▼ Expand Navbar":"▲ Collapse Navbar"}),e.jsxs("div",{className:`nav-container ${m?"collapsed":""}`,children:[e.jsx(J,{to:"/home",children:"Home"}),e.jsx(J,{to:"/home/dashboard",children:"Dashboard"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"mobile-toggle-fab",onClick:()=>S(!f),children:f?"✕":"✎"}),e.jsx("div",{className:`mobile-sidebar ${f?"open":""}`,children:e.jsxs("div",{className:"mobile-sidebar-content",children:[e.jsx("h3",{children:"Editor Tools"}),e.jsxs("div",{className:"mobile-button-grid",children:[e.jsx(i,{className:"mobile-toolbar-button "+(l?"active":""),onClick:()=>C("bold"),children:"B"}),e.jsx(i,{className:"mobile-toolbar-button "+(h?"active":""),onClick:()=>C("italic"),children:"I"}),e.jsx(i,{className:"mobile-toolbar-button "+(c?"active":""),onClick:()=>C("underline"),children:"U"}),e.jsx(i,{className:"mobile-toolbar-button",onClick:()=>_("h1"),children:"H1"}),e.jsx(i,{className:"mobile-toolbar-button",onClick:()=>_("paragraph"),children:"P"}),e.jsx(i,{className:"mobile-toolbar-button",disabled:!u,onClick:()=>U("undo"),children:"⟲"}),e.jsx(Z,{})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mobile-nav-links",children:[e.jsx(J,{to:"/home",children:"Home"}),e.jsx(J,{to:"/home/dashboard",children:"Dashboard"})]})]})})]})})}const Ke=({onChange:t})=>{const[a]=P();return x.useEffect(()=>a.registerUpdateListener(({editorState:r})=>t(r)),[a,t]),null},Ve={ltr:"ltr",rtl:"rtl",quote:"editor-quote",text:{bold:"font-bold",italic:"italic",underline:"underline",strikethrough:"strike-through"},heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3"},paragraph:"editor-paragraph"};function Xe(t){console.error(t)}const Ye=({title:t,status:a,draftResult:r,isUpdating:u,onTitleChange:g,onStatusChange:n,onEditorChange:s,onSubmit:l})=>{const p=R(c=>c.ui.imageUploading),h={namespace:"MyEditor",theme:Ve,onError:Xe,nodes:[Ue,Me,$e,Be,Ae,Oe],editorState:r||void 0},o=x.useCallback(c=>{const b=JSON.stringify(c.toJSON());s(b)},[s]);return e.jsxs(Ie,{initialConfig:h,children:[e.jsx(Ge,{}),e.jsxs("form",{className:"header-form",children:[e.jsx("input",{type:"text",maxLength:100,className:"header-input",value:t,required:!0,onChange:c=>g(c.target.value)}),e.jsxs("div",{className:"header-submit",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:a==="draft",onChange:()=>n(a==="published"?"draft":"published")})," ","Save as draft"]}),e.jsx(i,{type:"button",className:"submit-button",onClick:l,children:u?"Update":"Submit"})]})]}),e.jsx("div",{className:"editor-container",style:{pointerEvents:p?"none":"auto"},children:e.jsx(Pe,{contentEditable:e.jsx(we,{className:"editor"}),ErrorBoundary:Te})}),e.jsx(Qe,{}),e.jsx(We,{}),e.jsx(Ke,{onChange:o}),e.jsx(De,{})]})};export{Ye as default};
